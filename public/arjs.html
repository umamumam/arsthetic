<!DOCTYPE html>
<html>
<head>
    <title>AR Marker System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.0.4/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.2.0/aframe/build/aframe-ar.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; }
        .loading {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">Loading AR System...</div>

    <a-scene vr-mode-ui="enabled: false" embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-assets>
            <!-- Video Assets - Auto Generated -->
            <video id="vid1" src="/storage/videos/video1.mp4" preload="auto" loop muted playsinline></video>
            <video id="vid2" src="/storage/videos/video2.mp4" preload="auto" loop muted playsinline></video>
            <!-- Tambahkan lebih banyak sesuai kebutuhan -->
        </a-assets>

        <!-- Marker 1 -->
        <a-marker
            type="pattern"
            preset="custom"
            url="/storage/markers/marker1.patt"
            id="marker1">
            <a-video
                src="#vid1"
                width="1.6"
                height="0.9"
                position="0 0 0"
                rotation="-90 0 0">
            </a-video>
        </a-marker>

        <!-- Marker 2 -->
        <a-marker
            type="pattern"
            preset="custom"
            url="/storage/markers/marker2.patt"
            id="marker2">
            <a-video
                src="#vid2"
                width="1.6"
                height="0.9"
                position="0 0 0"
                rotation="-90 0 0">
            </a-video>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
    // Auto hide loader when AR ready
    document.querySelector('a-scene').addEventListener('loaded', function() {
        document.getElementById('loading').style.display = 'none';
    });

    // Video Controller
    AFRAME.registerComponent('video-control', {
        init: function() {
            const marker = this.el;
            const vidId = marker.id.replace('marker', 'vid');
            const video = document.getElementById(vidId);

            marker.addEventListener('markerFound', () => {
                if (video) {
                    video.currentTime = 0;
                    video.play().catch(e => console.log('Autoplay blocked'));
                }
            });

            marker.addEventListener('markerLost', () => {
                if (video) video.pause();
            });
        }
    });

    // Apply to all markers
    document.querySelectorAll('a-marker').forEach(marker => {
        marker.setAttribute('video-control', '');
    });
    </script>
</body>
</html>
